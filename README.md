# RASULOV-SCHOOL — пошаговая настройка «с нуля»

Это инструкция для тех, кто никогда не настраивал такой проект. Мы пройдём всё по шагам, по кнопкам, как в игре: что нажать, куда вписать, что должно получиться.

**Что это за проект:** сайт онлайн-школы. Посетитель видит свободные слоты, нажимает «Записаться», заполняет анкету. Учитель заходит в админку и управляет слотами и заявками.

---

## Что должно быть у тебя заранее

1. **Компьютер с интернетом.**
2. **Node.js** — программа для запуска этого проекта. Если не ставил:
   - Зайди на [nodejs.org](https://nodejs.org).
   - Скачай версию **LTS** (зелёная кнопка).
   - Установи, везде нажимай «Next».
   - В конце перезапусти компьютер (или закрой и открой терминал).
3. **Аккаунт Supabase** — там будет база данных и вход для учителя.
4. **Аккаунт Vercel** — туда потом зальёшь сайт в интернет (этот шаг можно сделать позже).

---

# Часть 1. Supabase — база данных и вход учителя

Supabase — это сервис, где хранятся пользователи, слоты и заявки. Сначала создаём проект, потом настраиваем таблицы и первого учителя.

---

## Шаг 1.1. Зайти в Supabase и создать проект

1. Открой браузер и перейди на сайт: **https://supabase.com**
2. В правом верхнем углу нажми кнопку **«Sign in»** (Войти).
3. Войди через **GitHub** или **Email** — как тебе удобнее. Если аккаунта нет, зарегистрируйся.
4. После входа ты окажешься в **Dashboard** (панель проектов).
5. Нажми большую зелёную кнопку **«New Project»** (Новый проект).
6. Появится форма:
   - **Name** — придумай имя, например: `rasulov-school`.
   - **Database Password** — придумай надёжный пароль и **обязательно сохрани его** в блокноте. Он понадобится только если будешь подключаться к базе напрямую (для нашей настройки можно не использовать).
   - **Region** — выбери ближайший регион (например, Frankfurt или London).
7. Внизу формы нажми **«Create new project»**.
8. Подожди 1–2 минуты, пока проект создаётся. На экране будет крутиться загрузка. Когда всё готово, откроется обзор проекта.

**Итог:** у тебя есть проект Supabase. Дальше мы возьмём из него два значения: ссылку на проект и ключ.

---

## Шаг 1.2. Скопировать ссылку и ключ проекта (для кода сайта)

Эти два значения нужно будет вставить в проект сайта, чтобы сайт мог общаться с базой.

1. В левом меню Supabase нажми на **шестерёнку** (внизу) — это **«Project Settings»** (Настройки проекта).
2. В открывшемся меню слева выбери пункт **«API»**.
3. На странице найди блок **«Project URL»**:
   - Рядом будет длинная ссылка вида `https://xxxxxxxx.supabase.co`.
   - Нажми кнопку **«Copy»** (копировать) рядом с этой ссылкой.
   - Вставь её в блокнот и подпиши: «Supabase URL».
4. Ниже найди блок **«Project API keys»**.
   - Там есть ключ **«anon» «public»** — он не секретный, его можно использовать в коде сайта.
   - Нажми **«Copy»** рядом с этим ключом (длинная строка из букв и цифр).
   - Вставь в блокнот и подпиши: «Supabase anon key».

**Итог:** у тебя в блокноте две строки — **URL** и **anon key**. Потом мы вставим их в файл `.env.local`.

---

## Шаг 1.3. Создать таблицы в базе (выполнить SQL)

Сейчас в базе пусто. Нужно один раз «запустить» скрипт, который создаёт таблицы и правила доступа.

1. В левом меню Supabase нажми **«SQL Editor»** (иконка с символом `</>` или надпись SQL Editor).
2. Нажми кнопку **«+ New query»** (Новый запрос) — откроется пустое поле для кода.
3. На своём компьютере открой папку с проектом **onlineschool**.
4. Открой папку **db**, затем файл **schema.sql** (можно в Блокноте, VS Code или Cursor).
5. Выдели **весь** текст в этом файле (Ctrl+A) и скопируй (Ctrl+C).
6. Вернись в браузер, в окно Supabase SQL Editor. Удали всё, что там есть (если есть), и вставь скопированный код (Ctrl+V).
7. Внизу справа нажми зелёную кнопку **«Run»** (или **«Run query»**).
8. Должно появиться сообщение вроде **«Success. No rows returned»** — это нормально. Значит, таблицы и правила созданы.

**Итог:** в базе появились таблицы `profiles`, `slots`, `bookings` и функция для записи на урок. Ошибки вроде «relation already exists» могут значить, что ты уже запускал этот скрипт раньше — тогда можно не переживать.

---

## Шаг 1.4. Создать пользователя «учитель» и дать ему роль

Учитель входит на сайт по email и паролю. Пользователя мы создаём в Supabase, а роль «teacher» прописываем в таблице `profiles`.

### 1.4.1. Создать пользователя (email + пароль)

1. В левом меню Supabase нажми **«Authentication»** (Авторизация).
2. Открой вкладку **«Users»** (Пользователи).
3. Нажми кнопку **«Add user»** → **«Create new user»**.
4. В форме:
   - **Email** — введи свой рабочий email (например, тот, с которого будешь заходить в админку).
   - **Password** — придумай пароль и **запомни или сохрани** его.
5. Нажми **«Create user»**.
6. В таблице пользователей появится новая строка. В колонке **«UID»** (или **«Id»**) будет длинный идентификатор вида `a1b2c3d4-e5f6-7890-abcd-ef1234567890`. **Скопируй этот UID целиком** и вставь в блокнот — это и есть «UUID учителя».

**Итог:** пользователь создан, у тебя есть его **UID** (UUID).

### 1.4.2. Прописать роль «teacher» в базе

1. Снова открой в Supabase **«SQL Editor»** → **«+ New query»**.
2. Вставь в окно такой текст (один раз замени `YOUR_TEACHER_UUID` на свой скопированный UID):

```sql
INSERT INTO profiles (id, role) VALUES ('YOUR_TEACHER_UUID', 'teacher')
ON CONFLICT (id) DO UPDATE SET role = 'teacher';
```

Пример: если твой UID `a1b2c3d4-e5f6-7890-abcd-ef1234567890`, то строка должна быть:

```sql
INSERT INTO profiles (id, role) VALUES ('a1b2c3d4-e5f6-7890-abcd-ef1234567890', 'teacher')
ON CONFLICT (id) DO UPDATE SET role = 'teacher';
```

3. Нажми **«Run»**.
4. Должно быть сообщение вроде **«Success. 1 row affected»**.

**Итог:** этот пользователь теперь имеет роль учителя и сможет зайти в админку сайта по адресу `/admin/login`.

---

# Часть 2. Настройка проекта на своём компьютере

Здесь мы вставим ссылку и ключ Supabase в проект и запустим сайт у себя локально.

---

## Шаг 2.1. Открыть папку проекта в терминале

1. Открой приложение **Терминал** (Windows: cmd или PowerShell; Mac/Linux: Terminal).
2. Перейди в папку проекта. Команда будет такой (подставь свой путь к папке):

   - Windows (PowerShell), пример:
     ```bash
     cd C:\Users\Fast\Desktop\onlineschool
     ```
   - Mac/Linux, пример:
     ```bash
     cd ~/Desktop/onlineschool
     ```

3. Нажми Enter. Строка приглашения должна показывать, что ты теперь в папке `onlineschool`.

**Итог:** терминал «стоит» в корне проекта.

---

## Шаг 2.2. Установить зависимости (если ещё не ставил)

1. В том же терминале введи команду:
   ```bash
   npm install
   ```
2. Нажми Enter. Будут скачиваться пакеты — подожди до конца (1–3 минуты).
3. Когда снова появится строка ввода без ошибок — всё готово.

**Итог:** все библиотеки проекта установлены.

---

## Шаг 2.3. Создать файл с секретными данными (.env.local)

Сайт не должен хранить ссылку и ключ Supabase в коде «в открытую». Их кладут в специальный файл `.env.local`, который не попадает в Git.

1. В корне проекта **onlineschool** (рядом с файлом `package.json`) создай файл с именем **`.env.local`** (точка в начале обязательна).
2. Открой этот файл в редакторе и вставь две строки, подставив **свои** значения из блокнота:

   ```env
   NEXT_PUBLIC_SUPABASE_URL=сюда_вставь_ссылку_из_шага_1.2
   NEXT_PUBLIC_SUPABASE_ANON_KEY=сюда_вставь_anon_ключ_из_шага_1.2
   ```

   Пример (не копируй буквально — подставь свои данные):

   ```env
   NEXT_PUBLIC_SUPABASE_URL=https://abcdefgh.supabase.co
   NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
   ```

3. Сохрани файл. Пробелы вокруг `=` не нужны, кавычки не ставь.

**Итог:** проект знает, к какому проекту Supabase подключаться.

---

## Шаг 2.4. Запустить сайт на своём компьютере

1. В терминале (всё в той же папке `onlineschool`) введи:
   ```bash
   npm run dev
   ```
2. Нажми Enter. Появится текст вроде «Ready on http://localhost:3000».
3. Открой браузер и перейди по адресу: **http://localhost:3000**

Ты должен увидеть главную страницу сайта (Hero, блоки, календарь слотов, FAQ). Если календарь пустой — это нормально: слотов пока нет, их добавляют в админке.

**Итог:** сайт работает локально.

---

## Шаг 2.5. Проверить вход учителя в админку

1. В браузере в адресной строке допиши к адресу: **/admin/login**  
   Получится: **http://localhost:3000/admin/login**
2. Должна открыться страница входа: поля «Email» и «Пароль».
3. Введи **тот же email и пароль**, которые задавал при создании пользователя в Supabase (шаг 1.4.1).
4. Нажми **«Войти»**.
5. Должен произойти переход на страницу **«Слоты»** (/admin/slots) с боковым меню: Слоты, Заявки, Выход.

Если видишь «Неверный email или пароль» — проверь, что вводишь данные того пользователя, которого создал в Supabase, и что роль `teacher` прописана в `profiles` (шаг 1.4.2).

**Итог:** учитель может заходить в админку.

---

## Шаг 2.6. Добавить первый слот (чтобы на главной было что показать)

1. В админке ты уже на странице **«Слоты»**. Нажми кнопку **«Создать слот»** (или **«+ Создать слот»**).
2. Откроется окно (диалог). Заполни:
   - **Дата и время** — выбери дату и время в будущем (например, завтра или послезавтра).
   - **Длительность (мин)** — например, `60`.
   - **Тип** — «Пробный» или «Обычный».
   - **Статус** — оставь **«Свободен»**.
   - **Вместимость** — `1`.
3. Нажми **«Создать»**.
4. Окно закроется, в таблице появится новый слот.
5. Открой в другой вкладке главную страницу **http://localhost:3000** и обнови её (F5). В блоке «Свободные слоты» должна появиться неделя с твоим слотом; у слота будет кнопка **«Записаться»**.

**Итог:** на сайте есть хотя бы один свободный слот, можно протестировать запись.

---

# Часть 3. Выложить сайт в интернет (Vercel)

Так сайт будет доступен по ссылке типа `https://твой-проект.vercel.app`. Нужен аккаунт на Vercel и код в Git (GitHub).

---

## Шаг 3.1. Залить проект на GitHub

1. Зайди на **https://github.com** и войди в аккаунт (или зарегистрируйся).
2. Нажми **«+»** в правом верхнем углу → **«New repository»**.
3. **Repository name** — например, `rasulov-school`. **Public**. Не ставь галочки на «Add README» и т.п., если проект уже есть у тебя на диске.
4. Нажми **«Create repository»**.
5. На следующей странице GitHub покажет команды. Нам нужны те, что под заголовком **«…or push an existing repository from the command line»**.
6. На своём компьютере открой терминал в папке проекта и выполни по очереди (подставь свой логин и имя репозитория вместо `YOUR_USERNAME` и `rasulov-school`):

   ```bash
   git init
   git add .
   git commit -m "Initial commit"
   git branch -M main
   git remote add origin https://github.com/YOUR_USERNAME/rasulov-school.git
   git push -u origin main
   ```

   Если Git спросит логин/пароль — используй данные от GitHub (для пароля может понадобиться Personal Access Token).

**Итог:** код проекта лежит на GitHub.

---

## Шаг 3.2. Подключить проект к Vercel и задать переменные

1. Зайди на **https://vercel.com** и войди (можно через GitHub).
2. На главной нажми **«Add New…»** → **«Project»**.
3. В списке репозиториев найди **rasulov-school** (или как назвал) и нажми **«Import»**.
4. На странице настроек проекта:
   - **Framework Preset** — Vercel сам подставит Next.js, можно не менять.
   - Важно: открой блок **«Environment Variables»** (Переменные окружения).
   - Добавь две переменные:
     - **Name:** `NEXT_PUBLIC_SUPABASE_URL`  
       **Value:** твоя ссылка Supabase (та же, что в `.env.local`).
     - **Name:** `NEXT_PUBLIC_SUPABASE_ANON_KEY`  
       **Value:** твой anon key из Supabase.
   - Для каждой переменной можно выбрать **Environment**: поставь галочку **Production** (и при желании Preview).
5. Внизу нажми **«Deploy»**.
6. Подожди 1–2 минуты. Когда сборка закончится, появится зелёная галочка и ссылка вида `https://rasulov-school-xxx.vercel.app`.

**Итог:** сайт в интернете по ссылке Vercel.

---

## Шаг 3.3. Разрешить Supabase принимать вход с твоего сайта

Чтобы вход в админку работал на твоём домене (или на `*.vercel.app`), нужно добавить этот адрес в настройках Supabase.

1. Открой **Supabase** → свой проект → слева **«Authentication»** → вкладка **«URL Configuration»** (или **Settings → Auth**).
2. Найди поле **«Redirect URLs»** (или **Site URL**).
3. Добавь строку (подставь свою ссылку Vercel):
   - `https://твой-проект.vercel.app/**`
   - Пример: `https://rasulov-school-xxx.vercel.app/**`
4. Сохрани настройки (**Save**).

**Итог:** после входа на сайте Vercel Supabase не будет блокировать редирект.

---

# Часть 4. Свой домен (по желанию)

Если хочешь, чтобы сайт открывался по своему домену (например, `rasulov-school.ru`):

1. В **Vercel** открой свой проект → вкладка **«Settings»** → **«Domains»**.
2. В поле введи свой домен (например, `rasulov-school.ru`) и нажми **«Add»**.
3. Vercel покажет, какие записи добавить у регистратора домена (обычно это A-запись или CNAME). Зайди в панель того, у кого куплен домен, и создай эти записи так, как написано в Vercel.
4. Подожди 5–60 минут, пока обновятся DNS. В Vercel статус домена станет «Verified».
5. В **Supabase** в **Redirect URLs** добавь ещё одну строку: `https://твой-домен.ru/**`.

**Итог:** сайт открывается по своему домену, вход в админку тоже работает.

---

# Краткая шпаргалка

| Что сделать | Где | Действие |
|-------------|-----|----------|
| Взять URL и ключ | Supabase → Project Settings → API | Copy у Project URL и anon key |
| Создать таблицы | Supabase → SQL Editor | Вставить `db/schema.sql` → Run |
| Создать учителя | Supabase → Authentication → Users | Add user → запомнить email и пароль |
| Взять UID учителя | Та же таблица Users | Скопировать UID (Id) пользователя |
| Дать роль teacher | Supabase → SQL Editor | Выполнить INSERT в `profiles` с этим UID |
| Запустить сайт локально | Терминал в папке проекта | `npm install` → создать `.env.local` → `npm run dev` |
| Войти в админку | Браузер | Открыть `/admin/login`, ввести email и пароль учителя |
| Выложить в интернет | Vercel | Import репозитория с GitHub, добавить ENV, Deploy |
| Разрешить вход с сайта | Supabase → Auth → URL Configuration | Добавить в Redirect URLs ссылку на Vercel/домен |

---

# Если что-то пошло не так

- **«Invalid API key»** или сайт не подключается к базе — проверь, что в `.env.local` (и на Vercel) точно скопированы URL и anon key без лишних пробелов и кавычек.
- **«Неверный email или пароль»** при входе в админку — проверь, что входишь тем пользователем, которого создал в Supabase, и что в `profiles` для его UID стоит роль `teacher`.
- На главной нет слотов — зайди в админку, раздел «Слоты», создай хотя бы один слот со статусом «Свободен» и датой в будущем.
- После деплоя на Vercel вход не работает — добавь в Supabase в Redirect URLs твой домен Vercel (`https://xxx.vercel.app/**`).

Если опишешь, на каком шаге застрял и какое сообщение видишь (или скрин), можно будет подсказать точнее.
